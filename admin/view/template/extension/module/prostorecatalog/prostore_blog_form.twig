{{ header }}{{ column_left }} 
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <button type="submit" form="form-blog" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a></div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %} 
        <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
        {% endfor %} 
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if (error_warning) %} 
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }} 
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %} 
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_form }}</h3>
      </div>
      <div class="panel-body">
        <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-blog" class="form-horizontal">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#tab-general" data-toggle="tab">{{ tab_general }}</a></li>
            <li><a href="#tab-data" data-toggle="tab">{{ tab_data }}</a></li>
            <li><a href="#tab-seo" data-toggle="tab">{{ tab_seo }}</a></li>
            <li><a href="#tab-design" data-toggle="tab">{{ tab_design }}</a></li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane active" id="tab-general">
              <ul class="nav nav-tabs" id="language">
                {% for language in languages %} 
                <li><a href="#language{{ language['language_id'] }}" data-toggle="tab"><img src="language/{{ language['code'] }}/{{ language['code'] }}.png" title="{{ language['name'] }}" /> {{ language['name'] }}</a></li>
                {% endfor %} 
              </ul>
              <div class="tab-content">
                {% for language in languages %} 
                <div class="tab-pane" id="language{{ language['language_id'] }}">
                  <div class="form-group required">
                    <label class="col-sm-2 control-label" for="input-title{{ language['language_id'] }}">{{ entry_title }}</label>
                    <div class="col-sm-10">
                      <input type="text" name="blog_description[{{ language['language_id'] }}][title]" value="{{ blog_description[language['language_id']] is defined ? blog_description[language['language_id']]['title'] : '' }}" placeholder="{{ entry_title }}" id="input-title{{ language['language_id'] }}" class="form-control" />
                      {% if (error_title[language['language_id']] is defined) %} 
                      <div class="text-danger">{{ error_title[language['language_id']] }}</div>
                      {% endif %} 
                    </div>
                  </div>
                  <div class="form-group required">
                    <label class="col-sm-2 control-label" for="input-description{{ language['language_id'] }}">{{ entry_description }}</label>
                    <div class="col-sm-10">
                      <textarea name="blog_description[{{ language['language_id'] }}][description]" placeholder="{{ entry_description }}" id="input-description{{ language['language_id'] }}" class="form-control" data-toggle="summernote" data-lang="{{ summernote }}">{{ blog_description[language['language_id']] is defined ? blog_description[language['language_id']]['description'] : '' }}</textarea>
                      {% if (error_description[language['language_id']] is defined) %} 
                      <div class="text-danger">{{ error_description[language['language_id']] }}</div>
                      {% endif %} 
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-meta-title{{ language['language_id'] }}">{{ entry_meta_title }}</label>
                    <div class="col-sm-10">
                      <input type="text" name="blog_description[{{ language['language_id'] }}][meta_title]" value="{{ blog_description[language['language_id']] is defined ? blog_description[language['language_id']]['meta_title'] : '' }}" placeholder="{{ entry_meta_title }}" id="input-meta-title{{ language['language_id'] }}" class="form-control" />
                      {% if (error_meta_title[language['language_id']] is defined) %} 
                      <div class="text-danger">{{ error_meta_title[language['language_id']] }}</div>
                      {% endif %} 
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-meta-h1{{ language['language_id'] }}">{{ entry_meta_h1 }}</label>
                    <div class="col-sm-10">
                      <input type="text" name="blog_description[{{ language['language_id'] }}][meta_h1]" value="{{ blog_description[language['language_id']] is defined ? blog_description[language['language_id']]['meta_h1'] : '' }}" placeholder="{{ entry_meta_h1 }}" id="input-meta-h1{{ language['language_id'] }}" class="form-control" />
                      {% if (error_meta_title[language['language_id']] is defined) %} 
                      <div class="text-danger">{{ error_meta_title[language['language_id']] }}</div>
                      {% endif %} 
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-meta-description{{ language['language_id'] }}">{{ entry_meta_description }}</label>
                    <div class="col-sm-10">
                      <textarea name="blog_description[{{ language['language_id'] }}][meta_description]" rows="5" placeholder="{{ entry_meta_description }}" id="input-meta-description{{ language['language_id'] }}" class="form-control">{{ blog_description[language['language_id']] is defined ? blog_description[language['language_id']]['meta_description'] : '' }}</textarea>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-meta-keyword{{ language['language_id'] }}">{{ entry_meta_keyword }}</label>
                    <div class="col-sm-10">
                      <textarea name="blog_description[{{ language['language_id'] }}][meta_keyword]" rows="5" placeholder="{{ entry_meta_keyword }}" id="input-meta-keyword{{ language['language_id'] }}" class="form-control">{{ blog_description[language['language_id']] is defined ? blog_description[language['language_id']]['meta_keyword'] : '' }}</textarea>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-tag{{ language['language_id'] }}">{{ entry_tag }}</label>
                    <div class="col-sm-10">
                      <input type="text" name="blog_description[{{ language['language_id'] }}][tag]" value="{{ blog_description[language['language_id']] is defined ? blog_description[language['language_id']]['tag'] : '' }}" placeholder="{{ entry_tag }}" id="input-tag{{ language['language_id'] }}" class="form-control" />
                      {% if (error_tag[language['language_id']] is defined) %} 
                      <div class="text-danger">{{ error_tag[language['language_id']] }}</div>
                      {% endif %} 
                    </div>
                  </div>
                </div>
                {% endfor %} 
              </div>
            </div>
            <div class="tab-pane" id="tab-data">
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_store }}</label>
                <div class="col-sm-10">
                  <div class="well well-sm" style="height: 150px; overflow: auto;">

                  {% for store in stores %}
                    <div class="checkbox">
                      <label> {% if store.store_id in blog_store %}
                        <input type="checkbox" name="blog_store[]" value="{{ store.store_id }}" checked="checked" />
                        {{ store.name }}
                        {% else %}
                        <input type="checkbox" name="blog_store[]" value="{{ store.store_id }}" />
                        {{ store.name }}
                        {% endif %}</label>
                    </div>
                    {% endfor %}
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-category">{{ entry_main_category }}</label>
                <div class="col-sm-10">
                  <select id="main_category_id" name="main_category_id" class="form-control">
                    <option value="0" selected="selected">{{ text_none }}</option>
                    {% for category in categories %} 
                    {% if (category['category_id'] == main_category_id) %} 
                    <option value="{{ category['category_id'] }}" selected="selected">{{ category['name'] }}</option>
                    {% else %} 
                    <option value="{{ category['category_id'] }}">{{ category['name'] }}</option>
                    {% endif %} 
                    {% endfor %} 
                  </select>
                </div>
              </div>


        <div class="form-group">
        <label class="col-sm-2 control-label" for="input-date"><span data-toggle="tooltip" title="{{ help_date_added }}">{{ entry_date_added }}</span></label>
        <div class="col-sm-10">         
            <div class="input-group date">
            <input type="text" name="date_added" value="{{ date_added }}" placeholder="{{ entry_date_added }}" data-date-format="YYYY-MM-DD" id="input-date-available" class="form-control" />
            <span class="input-group-btn">
            <button class="btn btn-default" type="button"><i class="fa fa-calendar"></i></button>
            </span></div>
        </div>
        </div>

             <div class="form-group">
                <label class="col-sm-2 control-label" for="input-related"><span data-toggle="tooltip" title="{{ help_related }}">{{ entry_related }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="related" value="" placeholder="{{ entry_related }}" id="input-related" class="form-control" />
                  <div id="blog-related" class="well well-sm" style="height: 150px; overflow: auto;">
                    {% for blog_related in blog_relateds %} 
                    <div id="blog-related{{ blog_related['blog_id'] }}"><i class="fa fa-minus-circle"></i> {{ blog_related['name'] }} 
                      <input type="hidden" name="blog_related[]" value="{{ blog_related['blog_id'] }}" />
                    </div>
                    {% endfor %} 
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-related"><span data-toggle="tooltip" title="{{ help_related_categories }}">{{ entry_related_categories }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="category-related" value="" placeholder="{{ entry_related_categories }}" id="input-related-categories" class="form-control" />
                  <div id="categories-related" class="well well-sm" style="height: 150px; overflow: auto;">
                    {% for category_related in categories_related %} 
                    <div id="category-related-{{ category_related['category_id'] }}"><i class="fa fa-minus-circle"></i> {{ category_related['name'] }} 
                      <input type="hidden" name="categories_related[]" value="{{ category_related['category_id'] }}" />
                    </div>
                    {% endfor %} 
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-related-banners"><span data-toggle="tooltip" title="{{ help_related_banners }}">{{ entry_related_banners }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="related-banners" value="" placeholder="{{ entry_related_banners }}" id="input-related-banners" class="form-control" />
                  <div id="banner-related" class="well well-sm" style="height: 150px; overflow: auto;">
                    {% for related_banner in related_banners %} 
                    <div id="banner-related-{{ related_banner['product_id'] }}"><i class="fa fa-minus-circle"></i> {{ related_banner['name'] }} 
                      <input type="hidden" name="banner_related[]" value="{{ related_banner['product_id'] }}" />
                    </div>
                    {% endfor %} 
                  </div>
                </div>
              </div>              

              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-related-products"><span data-toggle="tooltip" title="{{ help_related_products }}">{{ entry_related_products }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="related-products" value="" placeholder="{{ entry_related_products }}" id="input-related-products" class="form-control" />
                  <div id="product-related" class="well well-sm" style="height: 150px; overflow: auto;">
                    {% for product_related in product_relateds %} 
                    <div id="product-related{{ product_related['product_id'] }}"><i class="fa fa-minus-circle"></i> {{ product_related['name'] }} 
                      <input type="hidden" name="product_related[]" value="{{ product_related['product_id'] }}" />
                    </div>
                    {% endfor %} 
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2 control-label"><span data-toggle="tooltip" title="{{ help_image_preview }}">{{ entry_image_preview }}</span></label>
                <div class="col-sm-10"><a href="" id="thumb-image_preview" data-toggle="image" class="img-thumbnail"><img src="{{ thumb_preview }}" alt="" title="" data-placeholder="{{ placeholder }}" /></a>
                  <input type="hidden" name="image_preview" value="{{ image_preview }}" id="input-image_preview" />
                </div>
              </div>
			  
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_image }}</label>
                <div class="col-sm-10"><a href="" id="thumb-image" data-toggle="image" class="img-thumbnail"><img src="{{ thumb }}" alt="" title="" data-placeholder="{{ placeholder }}" /></a>
                  <input type="hidden" name="image" value="{{ image }}" id="input-image" />
                </div>
              </div>
              
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-status">{{ entry_status }}</label>
                <div class="col-sm-10">
                  <select name="status" id="input-status" class="form-control">
                    {% if (status) %} 
                    <option value="1" selected="selected">{{ text_enabled }}</option>
                    <option value="0">{{ text_disabled }}</option>
                    {% else %} 
                    <option value="1">{{ text_enabled }}</option>
                    <option value="0" selected="selected">{{ text_disabled }}</option>
                    {% endif %} 
                  </select>
                </div>
              </div>
            </div>


            <div class="tab-pane" id="tab-seo">
              <div class="alert alert-info"><i class="fa fa-info-circle"></i> {{ help_keyword }} </div>
              <div class="table-responsive">
                <table class="table table-bordered table-hover">
                  <thead>
                    <tr>
                      <td class="text-left">{{ entry_store }}</td>
                      <td class="text-left">{{ entry_keyword }}</td>
                    </tr>
                  </thead>
                  <tbody>
                  {% for store in stores %}
                  <tr>
                    <td class="text-left">{{ store.name }}</td>
                    <td class="text-left">{% for language in languages %}
                      <div class="input-group"><span class="input-group-addon"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" /></span>
                        <input type="text" name="blog_seo_url[{{ store.store_id }}][{{ language.language_id }}]" value="{% if blog_seo_url[store.store_id][language.language_id] %}{{ blog_seo_url[store.store_id][language.language_id] }}{% endif %}" placeholder="{{ entry_keyword }}" class="form-control" />
                      </div>
                      {% if error_keyword[store.store_id][language.language_id] %}
                      <div class="text-danger">{{ error_keyword[store.store_id][language.language_id] }}</div>
                      {% endif %} 
                      {% endfor %}</td>
                  </tr>
                  {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>


            <div class="tab-pane" id="tab-design">
              <div class="table-responsive">
                <table class="table table-bordered table-hover">
                  <thead>
                    <tr>
                      <td class="text-left">{{ entry_store }}</td>
                      <td class="text-left">{{ entry_layout }}</td>
                    </tr>
                  </thead>
                  <tbody>

                  {% for store in stores %}
                  <tr>
                    <td class="text-left">{{ store.name }}</td>
                    <td class="text-left"><select name="blog_layout[{{ store.store_id }}]" class="form-control">
                        <option value=""></option>
                        {% for layout in layouts %}
                        {% if blog_layout[store.store_id] and blog_layout[store.store_id] == layout.layout_id %}
                        <option value="{{ layout.layout_id }}" selected="selected">{{ layout.name }}</option>
                        {% else %}
                        <option value="{{ layout.layout_id }}">{{ layout.name }}</option>
                        {% endif %}
                        {% endfor %}
                      </select></td>
                  </tr>
                  {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script type="text/javascript"><!--
  {% if (ckeditor) %} 
    {% for language in languages %} 
      ckeditorInit('input-description{{ language['language_id'] }}', getURLVar('user_token'));
    {% endfor %} 
  {% endif %} 
  //--></script>
  <script type="text/javascript"><!--
$('#language a:first').tab('show');
$('.date').datetimepicker({
  pickTime: false
});
// Related
$('input[name=\'related\']').autocomplete({
  'source': function(request, response) {
    $.ajax({
      url: 'index.php?route=extension/module/prostore/prostore_blog/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
      dataType: 'json',
      success: function(json) {
        response($.map(json, function(item) {
          return {
            label: item['name'],
            value: item['blog_id']
          }
        }));
      }
    });
  },
  'select': function(item) {
    $('input[name=\'related\']').val('');

    $('#blog-related' + item['value']).remove();

    $('#blog-related').append('<div id="blog-related' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="blog_related[]" value="' + item['value'] + '" /></div>');
  }
});

$('#blog-related').delegate('.fa-minus-circle', 'click', function() {
  $(this).parent().remove();
});


// Related products
$('input[name=\'related-products\']').autocomplete({
  'source': function(request, response) {
    $.ajax({
      url: 'index.php?route=catalog/product/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
      dataType: 'json',
      success: function(json) {
        response($.map(json, function(item) {
          return {
            label: item['name'],
            value: item['product_id']
          }
        }));
      }
    });
  },
  'select': function(item) {
    $('input[name=\'related-products\']').val('');

    $('#product-related' + item['value']).remove();

    $('#product-related').append('<div id="product-related' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="product_related[]" value="' + item['value'] + '" /></div>');
  }
});

$('#product-related').delegate('.fa-minus-circle', 'click', function() {
  $(this).parent().remove();
});

// Related banners
$('input[name=\'related-banners\']').autocomplete({
  'source': function(request, response) {
    $.ajax({
      url: 'index.php?route=extension/module/prostore/prostore_blog_banner/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
      dataType: 'json',
      success: function(json) {
        response($.map(json, function(item) {
          return {
            label: item['name'],
            value: item['product_id'],
            title: item['comment']
          }
        }));
      }
    });
  },
  'select': function(item) {
    $('input[name=\'related-banners\']').val('');

    $('#banner-related' + item['value']).remove();

    $('#banner-related').append('<div id="banner-related-' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + item['title'] + '<input type="hidden" name="banner_related[]" value="' + item['value'] + '" /></div>');
  }
});

$('#banner-related').delegate('.fa-minus-circle', 'click', function() {
  $(this).parent().remove();
});

// Related categories
$('input[name=\'category-related\']').autocomplete({
  'source': function(request, response) {
    $.ajax({
      url: 'index.php?route=catalog/category/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
      dataType: 'json',
      success: function(json) {
        response($.map(json, function(item) {
          return {
            label: item['name'],
            value: item['category_id']
          }
        }));
      }
    });
  },
  'select': function(item) {
    $('input[name=\'category-related\']').val('');

    $('#categories-related' + item['value']).remove();

    $('#categories-related').append('<div id="category-related-' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="categories_related[]" value="' + item['value'] + '" /></div>');
  }
});

$('#categories-related').delegate('.fa-minus-circle', 'click', function() {
  $(this).parent().remove();
});

$(function() {  
	var nativeHtmlBuilderFunc = $('[data-toggle=\'summernote\']').summernote('module', 'videoDialog').createVideoNode;
	$('[data-toggle=\'summernote\']').each(function(i, obj) { 
    $(obj).summernote('module', 'videoDialog').createVideoNode = function(url) {
		  // get original generate html (that has the iframe...)
		  var html = nativeHtmlBuilderFunc(url);

		 // video url patterns(youtube, instagram, vimeo, dailymotion, youku, mp4, ogg, webm)
		  var ytRegExp = /^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;
		  var ytMatch = url.match(ytRegExp);

		  var igRegExp = /(?:www\.|\/\/)instagram\.com\/p\/(.[a-zA-Z0-9_-]*)/;
		  var igMatch = url.match(igRegExp);

		  var vRegExp = /\/\/vine\.co\/v\/([a-zA-Z0-9]+)/;
		  var vMatch = url.match(vRegExp);

		  var vimRegExp = /\/\/(player\.)?vimeo\.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/;
		  var vimMatch = url.match(vimRegExp);

		  var dmRegExp = /.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/;
		  var dmMatch = url.match(dmRegExp);

		  var youkuRegExp = /\/\/v\.youku\.com\/v_show\/id_(\w+)=*\.html/;
		  var youkuMatch = url.match(youkuRegExp);

		  var mp4RegExp = /^.+.(mp4|m4v)$/;
		  var mp4Match = url.match(mp4RegExp);

		  var oggRegExp = /^.+.(ogg|ogv)$/;
		  var oggMatch = url.match(oggRegExp);

		  var webmRegExp = /^.+.(webm)$/;
		  var webmMatch = url.match(webmRegExp);

		  var $video;
		  if (ytMatch && ytMatch[1].length === 11) {
			var youtubeId = ytMatch[1];
			$video = $('<div>')
				.append('<a href="//www.youtube.com/watch?v=' + youtubeId +'" data-fancybox><figure class="ui-video__figure"><picture class="ui-video__image"><source type="image/webp" srcset="//img.youtube.com/vi_webp/' + youtubeId + '/maxresdefault.webp"><img src="//img.youtube.com/vi/' + youtubeId + '/maxresdefault.jpg" alt="" width="820" height="400" loading="lazy"></picture><svg class="icon-video hide"><use xlink:href="catalog/view/theme/prostore/sprites/sprite.svg#icon-video"></use></svg></figure></a>');
		  } else if (igMatch && igMatch[0].length) {
			$video = $('<iframe>')
				.attr('frameborder', 0)
				.attr('src', 'https://instagram.com/p/' + igMatch[1] + '/embed/')
				.attr('width', '612').attr('height', '710')
				.attr('scrolling', 'no')
				.attr('allowtransparency', 'true');
		  } else if (vMatch && vMatch[0].length) {
			$video = $('<iframe>')
				.attr('frameborder', 0)
				.attr('src', vMatch[0] + '/embed/simple')
				.attr('width', '600').attr('height', '600')
				.attr('class', 'vine-embed');
		  } else if (vimMatch && vimMatch[3].length) {
			$video = $('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')
				.attr('frameborder', 0)
				.attr('src', '//player.vimeo.com/video/' + vimMatch[3])
				.attr('width', '640').attr('height', '360');
		  } else if (dmMatch && dmMatch[2].length) {
			$video = $('<iframe>')
				.attr('frameborder', 0)
				.attr('src', '//www.dailymotion.com/embed/video/' + dmMatch[2])
				.attr('width', '640').attr('height', '360');
		  } else if (youkuMatch && youkuMatch[1].length) {
			$video = $('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')
				.attr('frameborder', 0)
				.attr('height', '498')
				.attr('width', '510')
				.attr('src', '//player.youku.com/embed/' + youkuMatch[1]);
		  } else if (mp4Match || oggMatch || webmMatch) {
			$video = $('<video controls>')
				.attr('src', url)
				.attr('width', '640').attr('height', '360');
		  } else {
			// this is not a known video link. Now what, Cat? Now what?
			return false;
		  }

		  $video.addClass('note-video-clip');

		  return $video[0];
	  };
  });
});
  
//--></script></div>
{{ footer }} 